steps:
- task: DownloadBuildArtifacts@0
  displayName: 'Download compat results artifact'
  inputs:
    downloadType: specific
    itemPattern: '**\*.txt'
    downloadPath: '$(System.ArtifactsDirectory)\ApiCompat'
  condition: and(succeeded(), eq(variables['Build.Reason'], 'PullRequest'), ne(variables['System.PullRequest.IsFork'], 'True'))

- task: SOUTHWORKS.github-pr-comment.custom-publish-comment-task.github-pr-comment@0
  displayName: 'Publish compat results to Github'
  inputs:
    userToken: '$(GitHubCommentApiKey)'
    bodyFilePath: '$(System.ArtifactsDirectory)\ApiCompat'
    getSubFolders: true
  # Skip forks, as they can't get credentials.
  condition: and(succeeded(), eq(variables['Build.Reason'], 'PullRequest'), ne(variables['System.PullRequest.IsFork'], 'True'))

- script: |
   cd ..
   dir /s
  displayName: 'Dir workspace'
  continueOnError: true
  condition: succeededOrFailed()
